{% extends 'mart/base.html' %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Deliveries — {{ shop.name }}</h3>
    <div>
      <a class="btn btn-outline-secondary me-2" href="{% url 'shop_notifications' %}">Notifications</a>
      <a class="btn btn-outline-primary" href="{% url 'shop_dashboard' %}">Dashboard</a>
    </div>
  </div>

  {% if orders %}
    <div class="list-group">
      {% for order in orders %}
        <div class="list-group-item d-flex justify-content-between align-items-start">
          <div class="ms-2 me-auto">
            <div class="fw-bold">{{ order.shop.product_name }} — {{ order.quantity }} Kg</div>
            <div>Order #{{ order.id }} • Total: ₹{{ order.total_price }}</div>
            <div class="text-muted small">
              Customer: {{ order.customer.username }} |
              Phone: {{ order.customer.phone_number|default:order.customer.email|default:"N/A" }}
            </div>
            <div class="text-muted small">Ordered: {{ order.created_at }}</div>
          </div>

          <div class="text-end">
            {% if order.status == 'placed' %}
              <form method="post" action="{% url 'shop_mark_delivered' order.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-success btn-sm">Mark Delivered</button>
              </form>
            {% elif order.status == 'delivered' %}
              <span class="badge bg-success">Delivered</span>
            {% elif order.status == 'cancelled' %}
              <span class="badge bg-danger">Cancelled</span>
            {% else %}
              <span class="badge bg-secondary">{{ order.get_status_display }}</span>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info">No orders yet for this shop.</div>
  {% endif %}
</div>
{% endblock %}
